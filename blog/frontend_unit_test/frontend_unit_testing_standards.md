# 単体テストに関するコード規範

## テスト环境

以下のコマンドで、Vitest をインストールします。

```bash
pnpm install vitest --save-dev

# あるいは

pnpm install vitest -D
```

## テストファイルの整理

テストファイルはテスト対象モジュールと並列に `__tests__` ディレクトリに配置します。

## テストファイルの説明

各テストファイルは一つのモジュールまたはコンポーネントのみをテストします。

`component.js` のテストファイルは `component.spec.js` とします。

## テストケースの説明

各テストケースでは一つの概念のみをテストしてください。

単一のテストケースにおけるアサーションの数は、可能な限り少なくするべきです。

テストケースは説明的な**英語**で記述し、テストの目的を明確になるようにします。

例えば：

```js
it("should correctly calculate the sum of two numbers", () => {
  // テスト内容
});
```

> ❗ テストケースを作成する際に、`it` を統一して使用し、`test` を使用しないようにしましょう。

## テストケースの作成流れ

<!-- prettier-ignore -->
| Steps |  |  |
| --- | --- | --- |
| 1. **テスト用データを準備** | given | Arrange（準備） |
| 2. **テスト対象の機能/関数を呼び出す** | when | Act（実行） |
| 3. **機能の出力を検証** | then | Assert（検証） |
| 4. **ティアダウン** |||

> Arrange-Act-Assert (AAA) パターンに従う：準備（Arrange）、実行（Act）、アサート（Assert）。

第一歩と第四歩は必ずしも必要ではありません。

例えば、`getName()` をテストする時に、データの準備は必要ありません。

また、グローバルなデータに関わらない場合は、ティアダウンの必要がありません。

テスト中に、グローバルなデータやキャッシュを扱うことがあり、これらは元に戻す必要があります。これはティアダウンの役割です。

しかし、第二歩と第三歩は必要です。

## テスト范围

重要なメソッドと挙動をテスト範囲に含めて、境界値や例外状態もテストを行います。

## Mocks と Stubs

外部サービスや状態に依存しないように、`mocks` と `stubs` を使用してテストを隔離します。

## テストコードをレビュー

テストコードもレビューされることを確保するように、@nansyou にレビューを投げてください。

## GitLab CI/CD

CI/CD プロセスに Vitest を統合して、各コミットまたはマージリクエストでテストを実行します。
