# 如何理解 Webpack 配置底层结构逻辑

Webpack 的功能虽然非常全面和强大，但代价则是日益复杂、晦涩的使用方法。
开发者通常需要根据项目环境、资源类型、编译目标编写一份复杂的配置文件，用以定制资源打包行为。
但仅 Webpack 原生配置项就多达上百种，且各项之间缺乏一致性与关联度，
对初学者而言单是掌握每一个配置的作用与变种就已经很难，更不用说理解配置与配置之间的协作关系。

## 结构化理解 Webpack 配置项

Webpack 原生提供了上百种配置项，这些配置最终都会作用于 Webpack 打包过程的某个/几个阶段。

所以我们可以从流程角度，更框架性、结构化地，了解各项配置的作用。

### Webpack 的打包流程虽然非常复杂，但大致可简化分为以下四个阶段：

1. **输入**
   从文件系统读入代码文件；

2. **模块递归处理**
   调用 Loader 转译 Module 内容，
   并将结果转换为 AST，
   从中分析出模块依赖关系，
   进一步递归调用模块处理过程，
   直到所有依赖文件都处理完毕；

3. **后处理**
   所有模块递归处理完毕后开始执行后处理，
   包括模块合并、注入运行时、产物优化等，
   最终输出 Chunk 集合；

4. **输出**
   将 Chunk 写出到外部文件系统；

### 从打包流程来看，Webpack 配置项大体上可分为两类：

1. **流程类**
   主要控制 Webpack 打包编译过程的各个流程，并会直接影响编译打包效果。

2. **工具类**
   工具类独立于 Webpack 编译过程，提供一些额外的功能使得工程更易于使用。（提供额外的工程化能力）
   比方说 devtool 的 sourcemap，让索引位置更方便，
   比方 devServer 启动一个本地服务。
   这些都是 Webpack 编译流程不具备，但是对于整个工程却很重要的功能。

> 类比微波炉做菜，我们调配温度，时间，属于流程类配置，
> 菜好了“叮”一下，还是“叮咚”一下；是声音还是发个信息给手机；
> 这个配置和做菜本质无关，但是它提醒你快点取出防止菜凉了，是相辅相成的
>（虽然普通微波炉不具备工具类的配置）
> ——厨猿加加（评论区）
