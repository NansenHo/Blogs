# 整数的运算

## 基本整数运算

Java 的整数运算遵循四则运算规则，可以任意使用嵌套的小括号。

整数的数值**表示不但是精确的**，而且**整数运算永远是精确的**，即使是除法也是精确的，因为两个整数相除只能得到结果的整数部分。

> 特别注意：
> 
> 整数的除法对于除数为 0 时，
> 
> - 运行时将报错
> - 但编译不会报错

## 溢出

整数由于存在范围限制，如果计算结果超出了范围，就会产生溢出，溢出**不会出错**，但会得到一个奇怪的结果。

```java
int x = 2147483640;
int y = 15;
int sum = x + y;
System.out.println(sum); // -2147483641
```

要解决上面的问题，可以把 `int` 换成 `long` 类型，由于 `long` 可表示的整型范围更大，所以结果就不会溢出。

运算符可以简写：`-=` `+=` `*=` `/=`

## 自增/自减

`++` & `--`

注意，写在前面表示**先加再引用**，写在后面表示**先引用再加**。

> 不建议把自增自减混入到常规运算中，可读性非常低。

## 移位运算 `<<` & `>>`

在计算机中，整数总是以二进制的形式表示。

所以，我们可以对整数进行移位运算。

> 左移实际上就是不断地 * 2，右移实际上就是不断地 / 2。

> 对 `byte` 和 `short` 类型进行移位时，会首先转换为 `int` 再进行位移。

```java
int n = 7;       // 00000000 00000000 00000000 00000111 = 7
int a = n << 1;  // 00000000 00000000 00000000 00001110 = 14
int b = n << 2;  // 00000000 00000000 00000000 00011100 = 28
int c = n << 28; // 01110000 00000000 00000000 00000000 = 1879048192
int d = n << 29; // 11100000 00000000 00000000 00000000 = -536870912
// 左移 29 位时，由于最高位变成 1，因此结果变成了负数。
```

```java
int n = 7;       // 00000000 00000000 00000000 00000111 = 7
int a = n >> 1;  // 00000000 00000000 00000000 00000011 = 3
int b = n >> 2;  // 00000000 00000000 00000000 00000001 = 1
int c = n >> 3;  // 00000000 00000000 00000000 00000000 = 0
```

如果对一个负数进行右移，最高位的 `1` 不动，结果仍然是一个负数：

```java
int n = -536870912;
int a = n >> 1;  // 11110000 00000000 00000000 00000000 = -268435456
int b = n >> 2;  // 11111000 00000000 00000000 00000000 = -134217728
int c = n >> 28; // 11111111 11111111 11111111 11111110 = -2
int d = n >> 29; // 11111111 11111111 11111111 11111111 = -1
```

### 无符号的右移运算 `>>>`

其特点是不管符号位，右移后高位总是补 `0`。

因此，对一个负数进行 `>>>` 右移，它会变成正数。

```java
int n = -536870912;
int a = n >>> 1;  // 01110000 00000000 00000000 00000000 = 1879048192
int b = n >>> 2;  // 00111000 00000000 00000000 00000000 = 939524096
int c = n >>> 29; // 00000000 00000000 00000000 00000111 = 7
int d = n >>> 31; // 00000000 00000000 00000000 00000001 = 1
```

## 位运算

位运算是按位进行与、或、非和异或的运算。

对两个整数进行位运算，实际上就是**按位对齐**，然后依次对每一位进行运算。

```java
int i = 167776589; // 00001010 00000000 00010001 01001101
int n = 167776512; // 00001010 00000000 00010001 00000000
System.out.println(i & n); // 167776512
```

### 与运算 `&`

必须两个数都为 `1`，结果才是 `1`。

### 或运算 `|`

只要任意一个数为 `1`，结果就为 `1`。

### 非运算 `~`

`0` 和 `1` 互换。

### 异或运算 `^`

如果两个数不同，结果为 `1`，否则为 `0`。

## 运算优先级

运算优先级从高到低依次是：

- `()`
- `!` `~` `++` `--`
- `*` `/` `%`
- `+` `-`
- `<<` `>>` `>>>`
- `&`
- `|`
- `+=` `-=` `*=` `/=`

## 类型自动提升与强制转型

在运算过程中，如果参与运算的两个数类型不一致，那么计算结果为较大类型的整型。

`short` 和 `int` 计算，结果总是 `int`，原因是 `short` 首先自动被转型为 `int`。

也可以将结果强制转型 `(type)` ，即，将大范围的整数转型为小范围的整数。

```java
int i = 12345;
short s = (short) i; // 12345
```

注意，超出范围的强制转型会得到错误的结果，原因是转型时，`int` 的两个高位字节直接被扔掉，仅保留了低位的两个字节。
因此，强制转型的结果很可能是错的。




