# 依赖注入

## 依赖倒置原则

高层模块不应该依赖低层模块。

比如我们在 `fileContent` 函数里使用了 `fs.appendFileSync`。

这个时候，`fileContent` 是高层模块，`fs.appendFileSync` 是低层模块。

```bash
# a 直接依赖 b
a ---> b
```

这种情况下，写测试的话，就需要 mock `fs.appendFileSync`。

但如果我们有一个中间层接口，比如，

我们给 `fileContent` 函数多传入一个参数 `fileReader` 对象，

在这个对象里，定义一个 `read` 方法，`read` 里再去使用 `fs.appendFileSync`。

```bash
a ---> 接口
        ^
        |
        |
        b
```

这样我们写测试的时候，就不再需要 mock `fs.appendFileSync` 了。

而只需要往 `fileContent` 里传入一个带 `read` 方法（里面直接写死返回内容）的任意对象即可。

> JavaScript 是鸭子类型。

## 程序接缝

程序接缝是代码中的一个分界线，它允许我们将一个组件和其他组件隔离开来。

通过创建接缝，我们可以轻松地替换一个组件的实现，而不影响其他代码。

这有助于将组件之间的耦合度降至最低，使得代码更加模块化。

> 没有什么问题是不能通过增加中间层来解决的。
>
> 如果有，就加两层，加三层 ... 。
