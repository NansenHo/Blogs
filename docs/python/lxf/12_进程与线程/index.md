# 进程与线程

## ”多任务“ 操作系统

现代操作系统比如 Mac OS X，UNIX，Linux，Windows 等，都是支持“多任务”的操作系统。

”多任务“即，操作系统可以同时运行多个任务。

打个比方，你一边在用浏览器上网，一边在听 MP3，一边在用 Word 赶作业，这就是多任务，至少同时有 3 个任务正在运行。
还有很多任务悄悄地在后台同时运行着，只是桌面上没有显示而已。

## 单核 CPU 如何执行多任务

现在，多核 CPU 已经非常普及了，但是，即使过去的单核 CPU，也可以执行多任务。

单核 CPU 是怎么执行多任务的呢？

答案就是操作系统轮流让各个任务交替执行，任务 1 执行 0.01 秒，切换到任务 2，任务 2 执行 0.01 秒，再切换到任务 3，执行 0.01 秒……这样反复执行下去。表面上看，每个任务都是交替执行的，但是，由于 CPU 的执行速度实在是太快了，我们感觉就像所有任务都在同时执行一样。

真正的并行执行多任务只能在多核 CPU 上实现。

但是，由于任务数量远远多于 CPU 的核心数量，所以，操作系统也会自动把很多任务轮流调度到每个核心上执行。

由于每个进程至少要干一件事，所以，一个进程至少有一个线程。

多个线程可以同时执行，多线程的执行方式和多进程是一样的，也是由操作系统在多个线程之间快速切换，让每个线程都短暂地交替运行，看起来就像同时执行一样。

当然，真正地同时执行多线程需要多核 CPU 才可能实现。

## 多线程的 Python 程序

我们前面编写的所有的 Python 程序，都是执行单任务的进程，也就是只有一个线程。

有三种解决方案：

1. **多进程模式**

   启动多个进程，每个进程虽然只有一个线程，但多个进程可以一块执行多个任务。

2. **多线程模式**

   启动一个进程，在一个进程内启动多个线程，这样，多个线程也可以一块执行多个任务。

3. **多进程 + 多线程模式**

   启动多个进程，每个进程再启动多个线程，这样同时执行的任务就更多了，当然这种模型更复杂，实际很少采用。

同时执行多个任务通常各个任务之间并不是没有关联的，而是需要相互通信和协调。

有时，任务 1 必须暂停等待任务 2 完成后才能继续执行，

有时，任务 3 和任务 4 又不能同时执行，

所以，**多进程和多线程的程序的复杂度要远远高于我们前面写的单进程单线程的程序**。

因为复杂度高，调试困难，所以，不是迫不得已，我们也不想编写多任务。

但是，有很多时候，没有多任务还真不行。想想在电脑上看电影，就必须由一个线程播放视频，另一个线程播放音频。

Python 既支持多进程，又支持多线程。

> 线程是最小的执行单元，而进程由至少一个线程组成。如何调度进程和线程，完全由操作系统决定，程序自己不能决定什么时候执行，执行多长时间。

> 多进程和多线程的程序涉及到同步、数据共享的问题，编写起来更复杂。
