# 外键

## 什么是外键

可以把数据与另一张表关联起来的列，被称为外键。

## 外键约束

外键并不是通过列名实现的，而是通过定义外键约束实现的：

```
ALTER TABLE students
ADD CONSTRAINT fk_class_id
FOREIGN KEY (class_id)
REFERENCES classes (id);
```

- `fk_class_id` 是外键约束的名称。具体叫什么可以随意。
- `FOREIGN KEY (class_id)`指定了 `class_id` 作为外键。
- `REFERENCES classes (id)` 指定了这个外键将关联到 `classes` 表的 `id` 列（即 `classes` 表的主键）。

通过定义外键约束，关系数据库可以保证无法插入无效的数据。

即如果 `classes` 表不存在 `id=99` 的记录，`students` 表就无法插入 `class_id=99` 的记录。

> 由于外键约束会降低数据库的性能，大部分互联网应用程序为了追求速度，并不设置外键约束，而是仅靠应用程序自身来保证逻辑的正确性。

### 删除外键

要删除一个外键约束，也是通过 `ALTER TABLE` 实现的：

```
ALTER TABLE students
DROP FOREIGN KEY fk_class_id;
```

注意：删除外键约束并没有删除外键这一列。

删除列是通过 `DROP COLUMN ...` 实现的。

## 多对多

通过一个表的外键关联到另一个表，我们可以定义出一对多关系。

有些时候，还需要定义“多对多”关系。

多对多关系实际上是通过两个一对多关系实现的，即通过一个**中间表**，关联两个一对多关系，就形成了多对多关系。

现在有一个教师表，有一个班级表，还有一个教师班级对应表。（一个教师可以教多个班级）

在教师班级对应表里面，有对应关系 ID，教师 ID 和班级 ID 三个字段。

| id  | teacher_id | class_id |
| :-- | :--------- | :------- |
| 1   | 1          | 1        |
| 2   | 1          | 2        |
| 3   | 2          | 1        |
| 4   | 2          | 2        |
| 5   | 3          | 1        |
| 6   | 4          | 2        |

该表就是一个中间表。

从表中，我们可知：

1. `id=1` 的班级对应 `id=1,2,3` 的三位老师。

2. `id=1` 的老师对应 `id=1,2` 的两个班级。

因此，通过中间表，我们实现了一个”**多对多**“关系。

## 一对一

### 什么是一对一

一对一关系是指，一个表的记录对应到另一个表的唯一一个记录。

比如，每一个学生都可以有一个自己的联系方式。如果把联系方式存成一个表，我们就能得到”一对一“的关系。

### 为什么使用一对一关系

但，既然是一对一关系，那为啥不给 `students` 表增加一个 `contact` 列，这样就能合二为一了。

如果业务允许，完全可以把两个表合为一个表。

但是，有些时候，如果某个学生没有手机号，那么，`contacts` 表就不存在对应的记录。

实际上，一对一关系准确地说，是 `contacts` 表一对一对应 `students` 表。

还有一些应用会把一个大表拆成两个一对一的表，目的是**把经常读取和不经常读取的字段分开，以获得更高的性能**。

例如，把一个大的用户表分拆为用户基本信息表 `user_info` 和用户详细信息表 `user_profiles`，大部分时候，只需要查询 `user_info` 表，并不需要查询 `user_profiles` 表，这样就提高了查询速度。
