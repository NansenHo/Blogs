# 从 React 虚拟 DOM 架构升级看树和链表的关系 {ignore=true}

> 很多架构的升级，都是源于底层数据结构的变更。

React 从 Virtual DOM 转变为 Fiber DOM 也是由于底层数据结构的变更。

[toc]

## Virtual DOM 底层用的是树结构

尽管树结构有很多优势，比如

1. 很容易写递归
2. 天生和浏览器组织架构相吻合

但是我们在树结构中一般使用递归。
由于递归很难在执行中中断，
如果树很深，递归的时间超出了 16.6ms，
即浏览器一帧的时间，
那页面很可能就会卡顿，动画就会不流畅。

所以在 Fiber DOM 中 React 团队将底层数据结构改成了 链表。

遍历链表很容易在执行中中断。

## Fiber DOM 底层用的是链表

Fiber DOM 用链表记录的 DOM 结构如下图所示，

宏观上是一棵树，但实际上是链表。

Fiber DOM 的 diff 顺序是，先找子元素，再找兄弟元素，最后找父元素。

使用链表就可以在遍历过程中中断。
如果执行时间超过了 16.6ms，
那就先中断，
将中断处的 Fiber Node 记录在全局变量中，
等浏览器有空闲了再接着中断处继续执行。

> 如果把写一个程序比作为盖房子。
> 那数据结构就是我们要选择的砖型，算法就是我们要怎么盖。
> 不同的砖型适合不同盖法。
